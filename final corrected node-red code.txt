[
    {
        "id": "mqtt_input",
        "type": "mqtt in",
        "z": "flow_id",
        "name": "MQTT Input",
        "topic": "drowsy/alert",
        "qos": "2",
        "broker": "mqtt_broker_id",
        "x": 100,
        "y": 100,
        "wires": [["parse_json"]]
    },
    {
        "id": "parse_json",
        "type": "json",
        "z": "flow_id",
        "name": "Parse JSON",
        "x": 250,
        "y": 100,
        "wires": [["store_data", "debug_output"]]
    },
    {
        "id": "debug_output",
        "type": "debug",
        "z": "flow_id",
        "name": "Debug Output",
        "active": true,
        "x": 450,
        "y": 50,
        "wires": []
    },
    {
        "id": "store_data",
        "type": "function",
        "z": "flow_id",
        "name": "Store Data",
        "func": "var data = msg.payload;\nif (data) {\n    global.set('drowsy_data', data);\n}\nreturn msg;",
        "x": 400,
        "y": 150,
        "wires": [["driver_status", "led_status", "timestamp"]]
    },
    {
        "id": "driver_status",
        "type": "change",
        "z": "flow_id",
        "name": "Driver Status",
        "rules": [{"t": "set", "p": "payload", "to": "$.driver_status"}],
        "x": 600,
        "y": 100,
        "wires": []
    },
    {
        "id": "led_status",
        "type": "change",
        "z": "flow_id",
        "name": "LED Status",
        "rules": [{"t": "set", "p": "payload", "to": "$.led_status"}],
        "x": 600,
        "y": 150,
        "wires": []
    },
    {
        "id": "timestamp",
        "type": "change",
        "z": "flow_id",
        "name": "Timestamp",
        "rules": [{"t": "set", "p": "payload", "to": "$.timestamp"}],
        "x": 600,
        "y": 200,
        "wires": []
    },
    {
        "id": "http_dashboard_data",
        "type": "http in",
        "z": "flow_id",
        "name": "HTTP Dashboard Data",
        "url": "/dashboard",
        "method": "get",
        "x": 100,
        "y": 300,
        "wires": [["retrieve_data"]]
    },
    {
        "id": "retrieve_data",
        "type": "function",
        "z": "flow_id",
        "name": "Retrieve Data",
        "func": "var data = global.get('drowsy_data') || {};\nif (Object.keys(data).length === 0) {\n    msg.payload = { error: \"No object response\" };\n} else {\n    msg.payload = data;\n}\nreturn msg;",
        "x": 250,
        "y": 300,
        "wires": [["send_dashboard_data"]]
    },
    {
        "id": "send_dashboard_data",
        "type": "http response",
        "z": "flow_id",
        "name": "Send Dashboard Data",
        "statusCode": "200",
        "x": 450,
        "y": 300,
        "wires": []
    },
    {
        "id": "websocket_dashboard",
        "type": "websocket out",
        "z": "flow_id",
        "name": "WebSocket Dashboard",
        "server": "websocket_server_id",
        "x": 450,
        "y": 350,
        "wires": []
    }
]
